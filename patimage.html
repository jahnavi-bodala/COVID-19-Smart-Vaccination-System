<!DOCTYPE html>
<html lang="en">
  <head>
         <!-- jquery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<!-- web3 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.4.0/web3.min.js"></script>  
<script src="./node_modules/web3/dist/web3.min.js"></script>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.rawgit.com/ethereumjs/browser-builds/ddb27f8d/dist/ethereumjs-tx/ethereumjs-tx-1.3.3.min.js"></script>
    <script src="https://unpkg.com/ipfs-api/dist/index.min.js"></script>
  </head>
  <link rel="stylesheet" href="input.css">
<link rel="stylesheet" href="btn.css">
<link rel="stylesheet" href="prev.css">
  <script type="text/javascript">
    async function loadweb3(){
        if(window.ethereum){
            window.web3=new Web3(window.ethereum);
            window.ethereum.enable(); 
        } 
    }        
     async function loadContract(){
        web3=new Web3(web3.currentProvider);
          //ABI & address of owner who deployed it on metamask network in RemixIDE
          var ABI =[
	{
		"inputs": [],
		"stateMutability": "payable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "AvailabilityofVaccines",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "vaccinecount",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			},
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "SlotId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "slotBooked_on",
				"type": "string"
			}
		],
		"name": "BookSlot",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "CIDList",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			},
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "slotId",
				"type": "uint256"
			}
		],
		"name": "CancelSlot",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "DoctorList",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_index",
				"type": "uint256"
			}
		],
		"name": "GetMenudetails",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "i",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "l",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "s1",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "s2",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "s3",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "cs1",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "cs2",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "cs3",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			}
		],
		"name": "SignupSlotManager",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "ind",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "count_of_vaccines",
				"type": "uint256"
			}
		],
		"name": "Vaccine_count",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "location",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slottime1",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slottime2",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slottime3",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "s1c",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "s2c",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "s3c",
				"type": "uint256"
			}
		],
		"name": "createMenu",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "did",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "doctormapping",
		"outputs": [
			{
				"internalType": "string",
				"name": "Doctor",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "Age",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "Qualification",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "id",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getDoctor",
		"outputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_age",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_qualification",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getSM",
		"outputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_CIDList",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_Doctor_List",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "get_SlotManager_List",
		"outputs": [
			{
				"internalType": "address[]",
				"name": "",
				"type": "address[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "i",
				"type": "uint256"
			}
		],
		"name": "gethash",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"name": "isPatient",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "did",
				"type": "address"
			}
		],
		"name": "is_Doctor",
		"outputs": [
			{
				"internalType": "bool",
				"name": "value",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "did",
				"type": "address"
			}
		],
		"name": "is_SlotManager",
		"outputs": [
			{
				"internalType": "bool",
				"name": "value",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			}
		],
		"name": "patientdetails",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "age",
				"type": "uint8"
			},
			{
				"internalType": "string",
				"name": "bloodgroup",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "image",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotBooked_on",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotBooked_at",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotLocation",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "isvaccinated",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"name": "patientmapping",
		"outputs": [
			{
				"internalType": "bool",
				"name": "isuidgenerated",
				"type": "bool"
			},
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "age",
				"type": "uint8"
			},
			{
				"internalType": "string",
				"name": "bloodgroup",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "image",
				"type": "string"
			},
			{
				"internalType": "bool",
				"name": "isvaccinated",
				"type": "bool"
			},
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "status",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotBooked_at",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotBooked_on",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slotLocation",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "pid",
		"outputs": [
			{
				"internalType": "bytes32",
				"name": "",
				"type": "bytes32"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "cid",
				"type": "string"
			}
		],
		"name": "receive_CID",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "qualification",
				"type": "string"
			}
		],
		"name": "registerDoctor",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "sSlotlist",
		"outputs": [
			{
				"internalType": "string",
				"name": "loc",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "slot1",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slot2",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "slot3",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "s1_c",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "s2_c",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "s3_c",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "s_tc",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "vcount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "vaccinated_people_count",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint8",
				"name": "_age",
				"type": "uint8"
			},
			{
				"internalType": "string",
				"name": "_bloodgroup",
				"type": "string"
			}
		],
		"name": "signupPatient",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "slotmanagermapping",
		"outputs": [
			{
				"internalType": "string",
				"name": "slotmanager",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "id",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "age",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			}
		],
		"name": "updatePatientDetails",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes32",
				"name": "hash",
				"type": "bytes32"
			},
			{
				"internalType": "string",
				"name": "image",
				"type": "string"
			}
		],
		"name": "uploadimage",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "vaccinatedcount",
		"outputs": [
			{
				"internalType": "string[]",
				"name": "",
				"type": "string[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "index",
				"type": "uint256"
			}
		],
		"name": "viewvaccinatedcount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "i",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "loc",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
 var Address ='0xff15084c471585ce6c2918C117Fcb945d55F1184'
          return await new web3.eth.Contract(ABI,Address) 
      }   
      async function load(){
            await loadweb3();
         window.contract = await loadContract();
        }  
    load();  
	</script>   
	<body>
		<div>
			<br></br>  			<br></br> 			<br></br>
		<center><label>Hash:</label>
					<input type="text" id="pathash" placeholder="Enter Hash value">
	<br></br>                			
        Upload Image:
        <input type="file" name="photo" id="photo" onchange="loadFile(event)">
        <button  type="button" class="button" onclick="upload()" name="">upload</button>
        <input type="submit" class="button" onclick="confirm()" name="" value="send"></button></center>
		<a href="patientfunctions.html" class="previous round">&#8249 &#8249;</a>

		<img id="output"/>
    </br></br>
    <!-- <a id="url"></a><br> </br> -->
</br></br>      </br></br>     </br></br>

	<a id="iphash"></a><br></br>
    <img id="output"><br>
	</div>
  </body> 
</script>
  <script type="text/javascript">
    function upload() {
      const reader = new FileReader();
      reader.onloadend = function() {
        const ipfs = window.IpfsApi({ host: 'ipfs.infura.io', port: 5001, protocol: 'https' }) // Connect to IPFS
        const buf = ethereumjs.Buffer.Buffer(reader.result) // Convert data into buffer
        ipfs.files.add(buf, (err, result) => { // Upload buffer to IPFS
          if(err) {
            console.error(err)
            return
          }
		  let iphash=`http://ipfs.io/ipfs/${result[0].hash}`
           //let url = 'http://ipfs.io/ipfs/${result[0].hash}'
		   url=result[0].hash
          console.log(`Url --> http://ipfs.io/ipfs/${url}`)
		  //console.log(${url})
		  //s="http://ipfs.io/ipfs/"+url
         // document.getElementById("url").innerHTML= url
          //document.getElementById("url").href= url
		  document.getElementById("iphash").innerHTML= iphash
          document.getElementById("iphash").href= iphash
        })
      }
      const photo = document.getElementById("photo");
      reader.readAsArrayBuffer(photo.files[0]); // Read Provided File
    }
	var loadFile = function(event) {
    var output = document.getElementById('output');
    output.src = URL.createObjectURL(event.target.files[0]);
    output.onload = function() {
      URL.revokeObjectURL(output.src) // free memory
    }
  };
    async function confirm()
	{  
		pathash= $('#pathash').val( );  
            console.log(url)	
			console.log("ipfs")		 
			web3.eth.getAccounts().then(function(accountsA){
				  var accA = accountsA[0];
                  console.log("here")
				  return contract.methods.uploadimage(pathash,url).send({from:accA}); 					
			  })
	 }
  </script>

</html>